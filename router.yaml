sources:
  consul:
    host: 127.0.0.1
    port: 8500
    consistency: stale

sinks:
  haproxy:
    file: haproxy.cfg
    global:
      - daemon
    defaults:
      - retries 3
      - timeout connect 3s
      - timeout client 10m
      - timeout server 10m
    services:
      - riak-suanpan-pb
      - riak-quality-http

services:
  riak-suanpan-pb:
    discovery:
      method: consul
      service: riak-suanpan-pb
    haproxy:
      port: 3200
      options:
        - mode tcp
        - balance leastconn
      server_options: check inter 10000 rise 3 fall 2
  riak-quality-http:
    discovery:
      method: consul
      service: riak-quality-http
    haproxy:
      port: 3201
      options:
        - mode http
        - balance roundrobin
      server_options: check inter 10s rise 3 fall 2
