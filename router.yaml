program:
  services-config: services.yaml
  rack: ae-d
  
sources:
  consul:
    host: 127.0.0.1
    port: 8500
    consistency: stale

sinks:
  haproxy:
    service:
      config: services/haproxy.cfg
      pid-file: services/haproxy.pid
      check-config: services/haproxy -c -f {config}
      status: kill -20 $(cat {pidfile})
      start: services/haproxy -D -f {config} -p {pidfile}
      reload: services/haproxy -D -f {config} -p {pidfile} -sf $(cat {pidfile})
      socket: /tmp/haproxy.sock
      state-file: services/haproxy.state
    global:
      - stats socket /tmp/haproxy.sock mode 660 level admin
      - server-state-file services/haproxy.state
    defaults:
      - retries 3
      - timeout connect 5s
      - timeout client 10m
      - timeout server 10m
      - load-server-state-from-file global
    services:
      - riak-suanpan-pb:
          minimum: 2
      - riak-quality-http
      - ads-thrift:
          rack_aware: True
          minimum: 2
      - frequency-thrift:
          rack_aware: True
